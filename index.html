<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kick Channel Knob Test</title>
  <style>
    body {
      background: #111;
      color: #0ff;
      font-family: sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    canvas {
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 0 10px #0ff;
    }
    .label {
      margin-top: 10px;
      font-size: 14px;
    }
    .readout {
      font-size: 12px;
      color: #0f0;
    }
  </style>
</head>
<body>
  <h2>Kick Channel Volume</h2>
  <canvas id="knob" width="100" height="100"></canvas>
  <div class="label">Volume</div>
  <div class="readout" id="readout">0 dB</div>

  <script>
    // Audio setup
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = 100; // Kick-like test tone
    const gainNode = audioCtx.createGain();
    gainNode.gain.value = 1.0;
    osc.connect(gainNode).connect(audioCtx.destination);
    osc.start();

    // Knob setup
    const canvas = document.getElementById("knob");
    const ctx = canvas.getContext("2d");
    const readout = document.getElementById("readout");

    let angle = 0; // radians
    let value = 0; // dB
    let dragging = false;
    let lastY = 0;

    function dBToGain(db) {
      return Math.pow(10, db / 20);
    }

    function drawKnob() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const radius = 40;
      const cx = canvas.width / 2;
      const cy = canvas.height / 2;

      // Outer circle glow
      ctx.beginPath();
      ctx.arc(cx, cy, radius, 0, 2 * Math.PI);
      ctx.fillStyle = "#222";
      ctx.fill();
      ctx.strokeStyle = "#0ff";
      ctx.lineWidth = 4;
      ctx.shadowBlur = 10;
      ctx.shadowColor = "#0ff";
      ctx.stroke();
      ctx.shadowBlur = 0;

      // Marker dot
      const markerRadius = 6;
      const markerX = cx + (radius - 10) * Math.cos(angle - Math.PI / 2);
      const markerY = cy + (radius - 10) * Math.sin(angle - Math.PI / 2);

      ctx.beginPath();
      ctx.arc(markerX, markerY, markerRadius, 0, 2 * Math.PI);
      ctx.fillStyle = "#0ff";
      ctx.fill();
    }

    function updateValue(deltaY) {
      // Adjust angle and clamp
      angle -= deltaY * 0.01;
      const minAngle = -135 * Math.PI/180;
      const maxAngle = 135 * Math.PI/180;
      if (angle < minAngle) angle = minAngle;
      if (angle > maxAngle) angle = maxAngle;

      // Map angle to dB
      const range = 36; // -24dB to +12dB
      const normalized = (angle - minAngle) / (maxAngle - minAngle);
      value = -24 + normalized * range;

      // Apply to gain node
      gainNode.gain.value = dBToGain(value);

      // Update readout
      readout.textContent = value.toFixed(1) + " dB";

      drawKnob();
    }

    // Mouse / touch handling
    canvas.addEventListener("mousedown", (e) => {
      dragging = true;
      lastY = e.clientY;
    });
    window.addEventListener("mouseup", () => dragging = false);
    window.addEventListener("mousemove", (e) => {
      if (dragging) {
        updateValue(e.clientY - lastY);
        lastY = e.clientY;
      }
    });

    canvas.addEventListener("touchstart", (e) => {
      dragging = true;
      lastY = e.touches[0].clientY;
    });
    window.addEventListener("touchend", () => dragging = false);
    window.addEventListener("touchmove", (e) => {
      if (dragging) {
        updateValue(e.touches[0].clientY - lastY);
        lastY = e.touches[0].clientY;
      }
    });

    // Double click / tap reset
    canvas.addEventListener("dblclick", () => {
      angle = 0;
      value = 0;
      gainNode.gain.value = 1.0;
      readout.textContent = "0 dB";
      drawKnob();
    });

    drawKnob();
  </script>
</body>
</html>
